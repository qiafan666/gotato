package protocol

import (
	"bytes"
	"context"
	"encoding/hex"
	"encoding/json"
	"fmt"
	"github.com/qiafan666/gotato/commons/grpc"
	"testing"
	"time"

	"github.com/stretchr/testify/assert"
)

func TestRequest(t *testing.T) {
	protocol := new(TextRpcProtocol)

	data := []any{10630, []any{"USDT"}}
	marshal, _ := json.Marshal(data)

	request := &grpc.Message{
		Command:  grpc.CmdTestLogic,
		PkgType:  grpc.PkgTypeRequest,
		ReqId:    uint64(time.Now().UnixNano()),
		Sequence: uint32(time.Now().Unix()),
		Body:     marshal,
	}

	ctx := context.Background()
	reqEncode, err := protocol.Encode(ctx, request)
	x := hex.EncodeToString(reqEncode)
	fmt.Println(x)
	b, e := hex.DecodeString(x)
	assert.Nil(t, e, e)
	assert.Equal(t, reqEncode, b)

	assert.Equal(t, nil, err)

	reqDecode, err := protocol.Decode(ctx, bytes.NewReader(reqEncode))
	assert.Equal(t, nil, err)
	assert.ObjectsAreEqual(request, reqDecode)
}

func TestResponse(t *testing.T) {
	protocol := new(TextRpcProtocol)

	data := map[string]any{
		"a": 1,
		"b": true,
	}
	marshal, _ := json.Marshal(data)

	response := &grpc.Message{
		Command:  grpc.CmdTestLogic,
		PkgType:  grpc.PkgTypeReply,
		ReqId:    uint64(time.Now().UnixNano()),
		Sequence: 2,
		Result:   3,
		Body:     marshal,
	}

	ctx := context.Background()
	respEncode, err := protocol.Encode(ctx, response)
	assert.Equal(t, nil, err)

	respDecode, err := protocol.Decode(ctx, bytes.NewReader(respEncode))
	assert.Equal(t, nil, err)
	assert.ObjectsAreEqual(response, respDecode)
}

func TestUnpack(t *testing.T) {
	//cmd := uint32(403)
	//buf := make([]byte, 0)
	//buf = binary.LittleEndian.AppendUint32(buf, cmd)

	data := []byte{
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0xb9, 0xb9, 0xb9, 0xb9, 0xb9, 0xb9, 0xb9, 0xb9,
		0x45, 0x45, 0x45, 0x45, 0x45, 0x45, 0x45, 0x45,
		0xf5, 0xf5, 0xf5, 0xf5, 0xf5, 0xf5, 0xf5, 0xf5,

		0x62,
		0x65,
		0x65,
		0x70,
		0x93,
		0x01,
		0x00,
		0x00,
		0x00,
		0x00,
		0x00,
		0x00,
		0x00,
		0x00,
		0xb9,
		0x45,
		0xf5,
		0x4f,
		0xab,
		0x9b,
		0x65,
		0x00,
		0x7b,
		0xd4,
		0x65,
		0x8d,
		0x22,
		0x54,
		0xf3,
		0x7f,
		0x2a,
		0x00,
		0x00,
		0x00,
		0x00,
		0x00,
		0x5b,
		0x22,
		0x54,
		0x52,
		0x58,
		0x55,
		0x53,
		0x44,
		0x54,
		0x22,
		0x2c,
		0x20,
		0x31,
		0x36,
		0x38,
		0x37,
		0x38,
		0x32,
		0x34,
		0x30,
		0x30,
		0x30,
		0x2c,
		0x20,
		0x31,
		0x36,
		0x38,
		0x37,
		0x38,
		0x32,
		0x34,
		0x30,
		0x30,
		0x30,
		0x2c,
		0x20,
		0x38,
		0x36,
		0x34,
		0x30,
		0x30,
		0x5d,
	}

	data = append(data, data...)

	p := new(TextRpcProtocol)

	ctx := context.Background()
	reader := bytes.NewReader(data)
	resp, err := p.Decode(ctx, reader)
	assert.Equal(t, nil, err)
	resp, err = p.Decode(ctx, reader)
	assert.Equal(t, nil, err)

	t.Logf("%+v", resp)
}

func TestDecode(t *testing.T) {
	responseBody := `{"id":3741116688295679431,"result":[[1688526300,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688526360,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688526420,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688526480,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688526540,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688526600,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688526660,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688526720,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688526780,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688526840,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688526900,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688526960,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527020,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527080,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527140,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527200,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527260,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527320,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527380,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527440,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527500,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527560,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527620,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527680,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527740,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527800,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527860,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527920,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688527980,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528040,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528100,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528160,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528220,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528280,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528340,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528400,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528460,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528520,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528580,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528640,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528700,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528760,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528820,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528880,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688528940,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529000,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529060,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529120,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529180,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529240,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529300,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529360,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529420,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529480,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529540,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529600,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529660,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529720,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529780,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529840,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529900,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688529960,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530020,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530080,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530140,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530200,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530260,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530320,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530380,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530440,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530500,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530560,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530620,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530680,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530740,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530800,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530860,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530920,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688530980,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531040,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531100,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531160,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531220,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531280,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531340,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531400,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531460,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531520,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531580,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531640,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531700,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531760,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531820,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531880,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688531940,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532000,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532060,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532120,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532180,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532240,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532300,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532360,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532420,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532480,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532540,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532600,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532660,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532720,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532780,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532840,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532900,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688532960,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533020,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533080,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533140,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533200,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533260,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533320,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533380,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533440,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533500,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533560,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533620,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533680,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533740,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533800,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533860,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533920,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688533980,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534040,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534100,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534160,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534220,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534280,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534340,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534400,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534460,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534520,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534580,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534640,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534700,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534760,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534820,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534880,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688534940,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535000,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535060,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535120,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535180,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535240,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535300,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535360,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535420,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535480,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535540,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535600,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535660,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535720,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535780,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535840,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535900,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688535960,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536020,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536080,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536140,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536200,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536260,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536320,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536380,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536440,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536500,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536560,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536620,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536680,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536740,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536800,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536860,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536920,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688536980,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537040,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537100,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537160,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537220,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537280,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537340,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537400,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537460,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537520,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537580,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537640,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537700,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537760,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537820,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537880,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688537940,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538000,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538060,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538120,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538180,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538240,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538300,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538360,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538420,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538480,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538540,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538600,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538660,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538720,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538780,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538840,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538900,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688538960,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539020,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539080,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539140,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539200,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539260,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539320,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539380,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539440,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539500,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539560,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539620,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539680,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539740,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539800,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539860,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539920,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688539980,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540040,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540100,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540160,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540220,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540280,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540340,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540400,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540460,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540520,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540580,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540640,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540700,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540760,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540820,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540880,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688540940,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541000,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541060,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541120,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541180,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541240,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541300,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541360,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541420,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541480,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541540,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541600,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541660,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541720,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541780,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541840,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541900,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688541960,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542020,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542080,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542140,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542200,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542260,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542320,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542380,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542440,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542500,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542560,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542620,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542680,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542740,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542800,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542860,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542920,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688542980,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543040,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543100,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543160,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543220,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543280,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543340,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543400,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543460,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543520,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543580,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543640,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543700,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543760,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543820,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543880,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688543940,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688544000,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688544060,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688544120,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688544180,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"],[1688544240,"31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","31896.59178232402654135890","0","0","BTCUSDT"]],"error":null}`
	response := &grpc.Message{
		Command: grpc.CmdTestLogic,
		PkgType: grpc.PkgTypeReply,
		//ReqId:    uint64(time.Now().UnixNano()),
		ReqId:    uint64(3741116688295679431),
		Sequence: 2,
		Result:   0,
		Body:     []byte(responseBody),
	}

	ctx := context.Background()
	p := new(TextRpcProtocol)
	respEncode, err := p.Encode(ctx, response)
	assert.Equal(t, nil, err)

	data := append(respEncode, respEncode...)

	reader := bytes.NewReader(data)
	resp, err := p.Decode(ctx, reader)
	assert.Equal(t, nil, err)
	resp, err = p.Decode(ctx, reader)
	assert.Equal(t, nil, err)

	resp.Body = nil
	t.Logf("%+v", resp)
}

func TestRequestDecode(t *testing.T) {
	p := new(TextRpcProtocol)

	str := "62656570950100000000000000008aabee2a02000000e626e5ef81572c6d0f00000000005b2242544355534454222c322c305d"
	data, _ := hex.DecodeString(str)
	ctx := context.Background()
	req, err := p.Decode(ctx, bytes.NewReader(data))
	assert.Equal(t, nil, err)
	var v []any
	json.Unmarshal(req.Body, &v)
	t.Logf("%+v", v)
}

func TestHeartbeatPack(t *testing.T) {
	protocol := new(TextRpcProtocol)

	request := &grpc.Message{
		Command:   grpc.CmdTestLogic,
		PkgType:   grpc.PkgTypeRequest,
		Heartbeat: &grpc.Heartbeat{Timeout: 4000},
	}
	ctx := context.Background()
	reqEncode, err := protocol.Encode(ctx, request)
	x := hex.EncodeToString(reqEncode)
	fmt.Println(x)
	b, e := hex.DecodeString(x)
	assert.Nil(t, e, e)
	assert.Equal(t, reqEncode, b)

	assert.Equal(t, nil, err)

	reqDecode, err := protocol.Decode(ctx, bytes.NewReader(reqEncode))
	assert.Equal(t, nil, err)
	assert.ObjectsAreEqual(request, reqDecode)
}
